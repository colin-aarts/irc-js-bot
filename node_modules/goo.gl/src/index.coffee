
#	goo.gl
#	------
#	Shorten a URL using Google's goo.gl service

'use strict'


https = require 'https'


module.exports = (uri, cb) ->

	result = []

	req = https.request
		hostname: 'www.googleapis.com'
		path: '/urlshortener/v1/url'
		method: 'post'
		headers: 'Content-Type': 'application/json'
	, (res) ->
		res.setEncoding 'utf-8'
		res.on 'data', (data) ->
			result.push data
		res.on 'end', ->
			result = result.join ''
			result = JSON.parse result

			if not result or not result.id then err = true
			else result = result.id

			cb err, result

	req.on 'error', (err) ->
		cb err, null

	req.end """{ "longUrl": "#{uri}" }"""
