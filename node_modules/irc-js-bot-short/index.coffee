
#	irc-bot-js-short
#	----------------
#	URL shortener plug-in for irc-js-bot
#	This is an official plug-in
#
#	Provides one bot command: 'short'
#	Depends on the 'goo.gl' module

'use strict'


util    = require 'util'
https   = require 'https'
shorten = require 'goo.gl'
js      = (require 'js-extensions').local


module.exports = ->

	@register_special_command
		name: 'short'
		description: 'Turn a (long) URL into a short one using « goo.gl »'
		admin_only: false
		fn: (event, input_data, output_data) =>

			await shorten input_data.args, defer err, result

			if err
				message = "Oops, something went wrong trying to shorten « #{js.str_truncate input_data.args, 20, 10, '…'} »"
			else
				message = "Short URL for « #{js.str_truncate input_data.args, 20, 10, '…'} » is « #{result} »"

			@send output_data.method, output_data.recipient, message
